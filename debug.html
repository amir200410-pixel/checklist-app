<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×™×‘××’ - ×× ×”×œ ×”××©×™××•×ª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .debug-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        .debug-data {
            background: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ×“×£ ×“×™×‘××’</h1>
        
        <div class="debug-section">
            <h3>ğŸŒ ××™×“×¢ ×©×¨×ª</h3>
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>×›×ª×•×‘×ª ×©×¨×ª ×¨×©×ª:</strong><br>
                <code style="font-size: 1.1rem; color: #1976d2;">http://192.168.1.8:3000</code><br>
                <small style="color: #666;">×”×©×ª××© ×‘×›×ª×•×‘×ª ×–×• ×›×“×™ ×œ×’×©×ª ×œ××¢×¨×›×ª ××˜×œ×¤×•× ×™× ××—×¨×™×</small>
            </div>
            <h3>ğŸ“Š ××¦×‘ ×”××¢×¨×›×ª</h3>
            <div id="systemStatus"></div>
            <button class="btn" onclick="refreshStatus()">ğŸ”„ ×¨×¢× ×Ÿ</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ‘¥ ××©×ª××©×™× ×‘××¢×¨×›×ª</h3>
            <div id="usersData"></div>
            <button class="btn" onclick="createTestUsers()">â• ×¦×•×¨ ××©×ª××©×™ ×‘×“×™×§×”</button>
            <button class="btn danger" onclick="clearUsers()">ğŸ—‘ï¸ × ×§×” ××©×ª××©×™×</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“ ××©×™××•×ª</h3>
            <div id="tasksData"></div>
            <button class="btn" onclick="createTestTasks()">â• ×¦×•×¨ ××©×™××•×ª ×‘×“×™×§×”</button>
            <button class="btn danger" onclick="clearTasks()">ğŸ—‘ï¸ × ×§×” ××©×™××•×ª</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ”„ ×‘×§×©×•×ª ×”×¢×‘×¨×”</h3>
            <div id="transferRequestsData"></div>
            <button class="btn danger" onclick="clearTransferRequests()">ğŸ—‘ï¸ × ×§×” ×‘×§×©×•×ª ×”×¢×‘×¨×”</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ’¾ Session Storage</h3>
            <div id="sessionData"></div>
            <button class="btn danger" onclick="clearSession()">ğŸ—‘ï¸ × ×§×” Session</button>
        </div>

        <div class="debug-section">
            <h3>ğŸ”„ ×¡× ×›×¨×•×Ÿ × ×ª×•× ×™×</h3>
            <div id="syncData"></div>
            <button class="btn" onclick="manualSync()">ğŸ”„ ×¡× ×›×¨×•×Ÿ ×™×“× ×™</button>
            <button class="btn" onclick="refreshSyncStatus()">ğŸ“Š ×¨×¢× ×Ÿ ×¡×˜×˜×•×¡</button>
        </div>

        <div class="debug-section">
            <h3>ğŸŒ ×—×™×‘×•×¨ ×¨×©×ª</h3>
            <div id="networkData"></div>
            <button class="btn" onclick="refreshNetworkStatus()">ğŸ“¡ ×¨×¢× ×Ÿ ×—×™×‘×•×¨</button>
        </div>

        <div class="debug-section">
            <h3>ğŸ–¥ï¸ ×¡×˜×˜×•×¡ ×©×¨×ª</h3>
            <div id="serverData"></div>
            <button class="btn" onclick="refreshServerStatus()">ğŸ”„ ×¨×¢× ×Ÿ ×¡×˜×˜×•×¡ ×©×¨×ª</button>
            <button class="btn" onclick="forceSync()">âš¡ ×¡× ×›×¨×•×Ÿ ×›×¤×•×™</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ”§ ×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h3>
            <button class="btn" onclick="setupCompleteTest()">ğŸ¯ ×”×’×“×¨ ××¢×¨×›×ª ××œ××” ×œ×‘×“×™×§×”</button>
            <button class="btn danger" onclick="clearAllData()">ğŸ’¥ × ×§×” ×”×›×œ</button>
            <a href="welcome.html" class="btn">ğŸ  ×—×–×•×¨ ×œ×“×£ ×”×‘×™×ª</a>
        </div>
    </div>

    <script>
        function refreshStatus() {
            displaySystemStatus();
            displayUsers();
            displayTasks();
            displayTransferRequests();
            displaySessionData();
        }
        
        function displaySystemStatus() {
            const users = JSON.parse(localStorage.getItem('appUsers') || '[]');
            const tasks = JSON.parse(localStorage.getItem('manager-tasks') || '[]');
            const transferRequests = JSON.parse(localStorage.getItem('transferRequests') || '[]');
            
            const statusDiv = document.getElementById('systemStatus');
            let html = '';
            
            // ×‘×“×™×§×ª ××©×ª××©×™×
            if (users.length === 0) {
                html += '<div class="status error">âŒ ××™×Ÿ ××©×ª××©×™× ×‘××¢×¨×›×ª</div>';
            } else {
                const managers = users.filter(u => u.role === 'manager');
                const workers = users.filter(u => u.role === 'worker');
                html += `<div class="status success">âœ… ${users.length} ××©×ª××©×™× ×‘××¢×¨×›×ª (${managers.length} ×× ×”×œ×™×, ${workers.length} ×¢×•×‘×“×™×)</div>`;
            }
            
            // ×‘×“×™×§×ª ××©×™××•×ª
            if (tasks.length === 0) {
                html += '<div class="status warning">âš ï¸ ××™×Ÿ ××©×™××•×ª ×‘××¢×¨×›×ª</div>';
            } else {
                const pending = tasks.filter(t => t.status === 'pending').length;
                const completed = tasks.filter(t => t.status === 'completed').length;
                html += `<div class="status success">âœ… ${tasks.length} ××©×™××•×ª ×‘××¢×¨×›×ª (${pending} ×××ª×™× ×•×ª, ${completed} ×”×•×©×œ××•)</div>`;
            }
            
            // ×‘×“×™×§×ª ×‘×§×©×•×ª ×”×¢×‘×¨×”
            if (transferRequests.length === 0) {
                html += '<div class="status warning">âš ï¸ ××™×Ÿ ×‘×§×©×•×ª ×”×¢×‘×¨×”</div>';
            } else {
                const pending = transferRequests.filter(r => r.status === 'pending').length;
                html += `<div class="status success">âœ… ${transferRequests.length} ×‘×§×©×•×ª ×”×¢×‘×¨×” (${pending} ×××ª×™× ×•×ª)</div>`;
            }
            
            statusDiv.innerHTML = html;
        }
        
        function displayUsers() {
            const users = JSON.parse(localStorage.getItem('appUsers') || '[]');
            const usersDiv = document.getElementById('usersData');
            
            if (users.length === 0) {
                usersDiv.innerHTML = '<div class="status error">××™×Ÿ ××©×ª××©×™×</div>';
                return;
            }
            
            let html = '<div class="debug-data">';
            users.forEach(user => {
                html += `×©× ××©×ª××©: ${user.username}\n`;
                html += `×¡×™×¡××”: ${user.password}\n`;
                html += `×ª×¤×§×™×“: ${user.role}\n`;
                html += `×©× ××œ×: ${user.fullName || '×œ× ××•×’×“×¨'}\n`;
                html += `××™××™×™×œ: ${user.email || '×œ× ××•×’×“×¨'}\n`;
                html += `× ×•×¦×¨: ${user.createdAt || '×œ× ××•×’×“×¨'}\n`;
                html += '---\n';
            });
            html += '</div>';
            usersDiv.innerHTML = html;
        }
        
        function displayTasks() {
            const tasks = JSON.parse(localStorage.getItem('manager-tasks') || '[]');
            const tasksDiv = document.getElementById('tasksData');
            
            if (tasks.length === 0) {
                tasksDiv.innerHTML = '<div class="status warning">××™×Ÿ ××©×™××•×ª</div>';
                return;
            }
            
            let html = '<div class="debug-data">';
            tasks.forEach(task => {
                html += `××–×”×”: ${task.id}\n`;
                html += `×›×•×ª×¨×ª: ${task.title}\n`;
                html += `×¢×•×‘×“ ××—×¨××™: ${task.assignedWorker}\n`;
                html += `×¡×˜×˜×•×¡: ${task.status}\n`;
                html += `×¢×“×™×¤×•×ª: ${task.priority}\n`;
                html += `×ª××¨×™×š ×™×¢×“: ${task.deadline}\n`;
                html += '---\n';
            });
            html += '</div>';
            tasksDiv.innerHTML = html;
        }
        
        function displayTransferRequests() {
            const requests = JSON.parse(localStorage.getItem('transferRequests') || '[]');
            const requestsDiv = document.getElementById('transferRequestsData');
            
            if (requests.length === 0) {
                requestsDiv.innerHTML = '<div class="status warning">××™×Ÿ ×‘×§×©×•×ª ×”×¢×‘×¨×”</div>';
                return;
            }
            
            let html = '<div class="debug-data">';
            requests.forEach(request => {
                html += `××–×”×”: ${request.id}\n`;
                html += `××©×™××”: ${request.taskTitle}\n`;
                html += `××¢×•×‘×“: ${request.fromWorker}\n`;
                html += `×œ×¢×•×‘×“: ${request.toWorker}\n`;
                html += `×¡×˜×˜×•×¡: ${request.status}\n`;
                html += `× ×•×¦×¨: ${request.createdAt}\n`;
                html += '---\n';
            });
            html += '</div>';
            requestsDiv.innerHTML = html;
        }
        
        function displaySessionData() {
            const sessionDiv = document.getElementById('sessionData');
            let html = '<div class="debug-data">';
            
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                html += `${key}: ${value}\n`;
            }
            
            if (sessionStorage.length === 0) {
                html += '××™×Ÿ × ×ª×•× ×™× ×‘-Session Storage';
            }
            
            html += '</div>';
            sessionDiv.innerHTML = html;
        }
        
        function createTestUsers() {
            const testUsers = [
                {
                    username: 'admin',
                    password: '1234',
                    fullName: '×× ×”×œ ×¨××©×™',
                    email: 'admin@example.com',
                    role: 'manager',
                    createdAt: new Date().toISOString()
                },
                {
                    username: 'worker1',
                    password: '1234',
                    fullName: '×¢×•×‘×“ ×¨××©×•×Ÿ',
                    email: 'worker1@example.com',
                    role: 'worker',
                    createdAt: new Date().toISOString()
                },
                {
                    username: 'worker2',
                    password: '1234',
                    fullName: '×¢×•×‘×“ ×©× ×™',
                    email: 'worker2@example.com',
                    role: 'worker',
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('appUsers', JSON.stringify(testUsers));
            alert('âœ… × ×•×¦×¨×• ××©×ª××©×™ ×‘×“×™×§×” ×‘×”×¦×œ×—×”!');
            refreshStatus();
        }
        
        function createTestTasks() {
            const testTasks = [
                {
                    id: Date.now(),
                    title: '××©×™××ª ×‘×“×™×§×” ×¨××©×•× ×”',
                    description: '×ª×™××•×¨ ××©×™××ª ×‘×“×™×§×”',
                    assignedWorker: 'worker1',
                    deadline: new Date(Date.now() + 86400000).toISOString().slice(0, 16),
                    priority: 'medium',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                },
                {
                    id: Date.now() + 1,
                    title: '××©×™××ª ×‘×“×™×§×” ×©× ×™×™×”',
                    description: '×ª×™××•×¨ ××©×™××ª ×‘×“×™×§×” × ×•×¡×¤×ª',
                    assignedWorker: 'worker2',
                    deadline: new Date(Date.now() + 172800000).toISOString().slice(0, 16),
                    priority: 'high',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('manager-tasks', JSON.stringify(testTasks));
            alert('âœ… × ×•×¦×¨×• ××©×™××•×ª ×‘×“×™×§×” ×‘×”×¦×œ×—×”!');
            refreshStatus();
        }
        
        function clearUsers() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”××©×ª××©×™×?')) {
                localStorage.removeItem('appUsers');
                alert('ğŸ—‘ï¸ ×”××©×ª××©×™× × ××—×§×•');
                refreshStatus();
            }
        }
        
        function clearTasks() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”××©×™××•×ª?')) {
                localStorage.removeItem('manager-tasks');
                alert('ğŸ—‘ï¸ ×”××©×™××•×ª × ××—×§×•');
                refreshStatus();
            }
        }
        
        function clearTransferRequests() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×‘×§×©×•×ª ×”×”×¢×‘×¨×”?')) {
                localStorage.removeItem('transferRequests');
                alert('ğŸ—‘ï¸ ×‘×§×©×•×ª ×”×”×¢×‘×¨×” × ××—×§×•');
                refreshStatus();
            }
        }
        
        function clearSession() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×”-Session?')) {
                sessionStorage.clear();
                alert('ğŸ—‘ï¸ ×”-Session × ××—×§');
                refreshStatus();
            }
        }
        
        function setupCompleteTest() {
            createTestUsers();
            createTestTasks();
            alert('ğŸ¯ ×”××¢×¨×›×ª ××•×›× ×” ×œ×‘×“×™×§×”!\n\n×¤×¨×˜×™ ×”×ª×—×‘×¨×•×ª:\n×× ×”×œ: admin / 1234\n×¢×•×‘×“: worker1 / 1234');
        }
        
        function clearAllData() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™× ×‘××¢×¨×›×ª?')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('ğŸ’¥ ×›×œ ×”× ×ª×•× ×™× × ××—×§×•');
                refreshStatus();
            }
        }
        
        function displaySyncData() {
            const syncDiv = document.getElementById('syncData');
            if (typeof window.checkSyncStatus === 'function') {
                const status = window.checkSyncStatus();
                let html = '<div class="debug-data">';
                html += `×¡× ×›×¨×•×Ÿ ×¤×¢×™×œ: ${status.isRunning ? 'âœ…' : 'âŒ'}\n`;
                html += `×–××Ÿ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ${status.timestamp}\n`;
                html += '× ×ª×•× ×™× ××—×¨×•× ×™×:\n';
                Object.keys(status.lastSync).forEach(key => {
                    const data = status.lastSync[key];
                    html += `  ${key}: ${Array.isArray(data) ? data.length : 'N/A'} ×¤×¨×™×˜×™×\n`;
                });
                html += '</div>';
                syncDiv.innerHTML = html;
            } else {
                syncDiv.innerHTML = '<div class="status error">×× ×”×œ ×”×¡× ×›×¨×•×Ÿ ×œ× ×–××™×Ÿ</div>';
            }
        }

        function displayNetworkData() {
            const networkDiv = document.getElementById('networkData');
            if (typeof window.checkNetwork === 'function') {
                const status = window.checkNetwork();
                let html = '<div class="debug-data">';
                html += `××—×•×‘×¨ ×œ×¨×©×ª: ${status.online ? 'âœ…' : 'âŒ'}\n`;
                html += `×“×¤×“×¤×Ÿ: ${status.userAgent.split(' ')[0]}\n`;
                html += `×–××Ÿ ×‘×“×™×§×”: ${status.timestamp}\n`;
                html += '</div>';
                networkDiv.innerHTML = html;
            } else {
                networkDiv.innerHTML = '<div class="status error">×¤×•× ×§×¦×™×™×ª ×‘×“×™×§×ª ×¨×©×ª ×œ× ×–××™× ×”</div>';
            }
        }

        function refreshSyncStatus() {
            displaySyncData();
        }

        function displayServerData() {
            const serverDiv = document.getElementById('serverData');
            if (typeof window.getServerStatus === 'function') {
                window.getServerStatus().then(status => {
                    if (status) {
                        let html = '<div class="debug-data">';
                        html += `×¡×˜×˜×•×¡ ×©×¨×ª: ${status.server}\n`;
                        html += `××©×ª××©×™×: ${status.users}\n`;
                        html += `××©×™××•×ª: ${status.tasks}\n`;
                        html += `×‘×§×©×•×ª ×”×¢×‘×¨×”: ${status.transfers}\n`;
                        html += `×–××Ÿ ×¢×“×›×•×Ÿ: ${new Date(status.timestamp * 1000).toLocaleString('he-IL')}\n`;
                        html += '</div>';
                        serverDiv.innerHTML = html;
                    } else {
                        serverDiv.innerHTML = '<div class="status error">×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ×©×¨×ª</div>';
                    }
                });
            } else {
                serverDiv.innerHTML = '<div class="status error">×¤×•× ×§×¦×™×™×ª ×¡×˜×˜×•×¡ ×©×¨×ª ×œ× ×–××™× ×”</div>';
            }
        }

        async function forceSync() {
            if (typeof window.forceSync === 'function') {
                const result = await window.forceSync();
                alert(result);
                refreshStatus();
            } else {
                alert('×¤×•× ×§×¦×™×™×ª ×¡× ×›×¨×•×Ÿ ×œ× ×–××™× ×”');
            }
        }

        function refreshServerStatus() {
            displayServerData();
        }

        function refreshNetworkStatus() {
            displayNetworkData();
        }

        function refreshStatus() {
            displaySystemStatus();
            displayUsers();
            displayTasks();
            displayTransferRequests();
            displaySessionData();
            displaySyncData();
            displayNetworkData();
            displayServerData();
        }

        // ×˜×¢×™× ×ª ×”× ×ª×•× ×™× ×‘×˜×¢×™× ×ª ×”×“×£
        document.addEventListener('DOMContentLoaded', refreshStatus);
    </script>
</body>
</html> 